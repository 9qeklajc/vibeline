name: yolopost
description: Post to nostr when trigger words are detected
run: matching
keywords: ["good morning", "test", "blossom upload", "breakfast"]
match: all
output_extension: ".json"
command: |
  # Read the title from title plugin output
  title_file="VoiceMemos/titles/$(basename AUDIO_FILE .m4a).txt"
  title=""
  if [ -f "$title_file" ]; then
    title=$(cat "$title_file" | tr -d '\n\r')
  fi
  
  # Read the upload link from blossom plugin output using jq
  blossom_file="VoiceMemos/blossoms/$(basename AUDIO_FILE .m4a).json"
  upload_link=""
  if [ -f "$blossom_file" ]; then
    upload_link=$(jq -r '.url' "$blossom_file" 2>/dev/null)
  fi
  
  # Check if both title and upload link are available
  if [ -z "$title" ]; then
    echo "Error: Title file not found or empty: $title_file" >&2
    exit 1
  fi
  
  if [ -z "$upload_link" ]; then
    echo "Error: Upload link not found in blossom output: $blossom_file" >&2
    exit 1
  fi
  
  # Combine title and upload link and publish directly
  (echo "$title"; echo "$upload_link") | nak publish --sec $YOLOPOST_NSEC $RELAYS
